var flickr_image_slider=function(){var e={};return e.init=function(){e.page=1,e.refreshRate=5e3,e.imageRequest=null,e.imageBuffer=[],e.requestImageTimer=null,e.$container=$$(".flickr-image-slider")[0],e.$currentSlide=null,e.startRequestingImages(),e.start()},e.start=function(){var t,r,a,n,i=e.refreshRate,s=e.$container.getSize();e.imageBuffer.length>0?(n=e.imageBuffer.shift(),a=new Element("img",{src:"http://farm"+n.farm+".staticflickr.com/"+n.server+"/"+n.id+"_"+n.secret+"_q.jpg"}),r=new Element("a",{href:"http://www.flickr.com/photos/"+n.owner.nsid+"/"+n.id,target:"_blank"}),t=new Element("div",{"class":"flickr-image-slide"}),t.adopt(r.adopt(a)),null!=e.$currentSlide?(t.setStyles({top:0,left:-s.x}),e.$container.adopt(t),new Fx.Tween(e.$currentSlide,{duration:1e3,transition:"linear",property:"left"}).start(0,s.x),new Fx.Tween(t,{duration:1e3,transition:"linear",property:"left"}).start(-s.x,0)):e.$container.adopt(t),e.$currentSlide=t):i=100,setTimeout(function(){e.start()},i)},e.startRequestingImages=function(){e.requestImages(),setInterval(function(){e.imageBuffer.length<=2&&e.requestImages()},1e3)},e.requestImages=function(){var t=e.page>1?5:1;null==e.imageRequest&&(e.imageRequest=new Request({url:"http://localhost:8888/api/flickr-images/",method:"get",onSuccess:function(t){var r;try{r=JSON.parse(t),"number"==typeof r.refresh_rate&&(e.refreshRate=r.refresh_rate),"array"===typeOf(r.images)&&(e.imageBuffer=e.imageBuffer.concat(r.images))}catch(a){}},onComplete:function(){e.imageRequest=null}}),e.imageRequest.send("page="+e.page+"&per_page="+t),e.page++)},window.addEvent("domready",function(){e.init()}),e}();