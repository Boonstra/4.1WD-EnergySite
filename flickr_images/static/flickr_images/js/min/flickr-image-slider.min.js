var flickr_image_slider=function(){var e={};return e.init=function(){e.page=1,e.refreshRate=5e3,e.imageRequest=null,e.imageBuffer=[],e.requestImageTimer=null,e.$sliderContainer=$$(".flickr-image-slider")[0],e.$descriptionContainer=$$(".flickr-image-description-container")[0],e.$currentSlide=null,e.$currentDescription=null,e.startRequestingImages(),e.start()},e.start=function(){var t,i,r,n,a,s=e.refreshRate,o=e.$sliderContainer.getSize(),l=e.$currentSlide,c=e.$currentDescription;e.imageBuffer.length>0?(a=e.imageBuffer.shift(),n=new Element("img",{src:"http://farm"+a.farm+".staticflickr.com/"+a.server+"/"+a.id+"_"+a.secret+"_q.jpg"}),r=new Element("a",{href:"http://www.flickr.com/photos/"+a.owner.nsid+"/"+a.id,target:"_blank"}),i=new Element("div",{"class":"flickr-image-description"}),i.adopt(new Element("div",{text:a.title._content,"class":"flickr-image-title"})),i.adopt(new Element("div",{text:a.dates.taken,"class":"flickr-image-date"})),t=new Element("div",{"class":"flickr-image-slide"}),t.adopt(r.adopt(n)),null!=e.$currentSlide&&null!=e.$currentDescription?(t.setStyles({top:0,left:-o.x}),i.setStyles({opacity:0,visibility:"hidden"}),e.$sliderContainer.adopt(t),e.$descriptionContainer.adopt(i),new Fx.Tween(e.$currentSlide,{duration:1e3,transition:"linear",property:"left"}).start(0,o.x),new Fx.Tween(t,{duration:1e3,transition:"linear",property:"left"}).start(-o.x,0),e.$currentDescription.set("tween",{duration:1e3}).fade("out"),setTimeout(function(){l.destroy(),c.destroy(),i.set("tween",{duration:1e3}).fade("in")},1e3)):(e.$sliderContainer.adopt(t),e.$descriptionContainer.adopt(i)),e.$currentSlide=t,e.$currentDescription=i):s=100,setTimeout(function(){e.start()},s)},e.startRequestingImages=function(){e.requestImages(),setInterval(function(){e.imageBuffer.length<=2&&e.requestImages()},1e3)},e.requestImages=function(){var t=e.page>1?5:1;null==e.imageRequest&&(e.imageRequest=new Request({url:"http://localhost:8888/api/flickr-images/",method:"get",onSuccess:function(t){var i;try{i=JSON.parse(t),"number"==typeof i.refresh_rate&&(e.refreshRate=i.refresh_rate),"array"===typeOf(i.images)&&(e.imageBuffer=e.imageBuffer.concat(i.images))}catch(r){}},onComplete:function(){e.imageRequest=null}}),e.imageRequest.send("page="+e.page+"&per_page="+t),e.page++)},window.addEvent("domready",function(){e.init()}),e}();